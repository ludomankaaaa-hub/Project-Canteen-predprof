{% extends "base.html" %}

{% block title %}–ú–µ–Ω—é - –®–∫–æ–ª—å–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è{% endblock %}

{% block content %}
<div class="menu-container">
    <div class="menu-header">
        <h1><i class="fas fa-utensils"></i> –ú–µ–Ω—é —Å—Ç–æ–ª–æ–≤–æ–π</h1>

        <div class="date-selector">
            <label for="menu-date">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
            <input type="date" id="menu-date" value="{{ current_date }}"
                   onchange="window.location.href='/menu?date=' + this.value">
        </div>

        <div class="current-date">
            <h2>{{ current_date.strftime('%d.%m.%Y') }}</h2>
            <p>{{ ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'][current_date.weekday()] }}</p>
        </div>
    </div>

    {% if menus %}
    <div class="menu-sections">
        <!-- –ó–∞–≤—Ç—Ä–∞–∫–∏ -->
        <div class="menu-section">
            <h3><i class="fas fa-sun"></i> –ó–∞–≤—Ç—Ä–∞–∫–∏</h3>
            <div class="menu-items">
                {% for menu in menus if menu.meal_type == 'breakfast' %}
                <div class="menu-item-card">
                    <div class="menu-item-header">
                        <h4>{{ menu.dish_name }}</h4>
                        <span class="price">{{ menu.price }} ‚ÇΩ</span>
                    </div>
                    <p class="description">{{ menu.description }}</p>
                    <div class="menu-item-info">
                        <span class="available">–î–æ—Å—Ç—É–ø–Ω–æ: {{ menu.available_count }} –ø–æ—Ä—Ü–∏–π</span>
                        {% if user and user.role == 'student' %}
                        <form method="POST" action="{{ url_for('create_order_frontend') }}" class="order-form">
                            <input type="hidden" name="menu_id" value="{{ menu.id }}">
                            <button type="submit" class="btn btn-sm btn-primary"
                                    {% if menu.available_count <= 0 %}disabled{% endif %}>
                                <i class="fas fa-shopping-cart"></i> –ó–∞–∫–∞–∑–∞—Ç—å
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –û–±–µ–¥—ã -->
        <div class="menu-section">
            <h3><i class="fas fa-utensil-spoon"></i> –û–±–µ–¥—ã</h3>
            <div class="menu-items">
                {% for menu in menus if menu.meal_type == 'lunch' %}
                <div class="menu-item-card">
                    <div class="menu-item-header">
                        <h4>{{ menu.dish_name }}</h4>
                        <span class="price">{{ menu.price }} ‚ÇΩ</span>
                    </div>
                    <p class="description">{{ menu.description }}</p>
                    <div class="menu-item-info">
                        <span class="available">–î–æ—Å—Ç—É–ø–Ω–æ: {{ menu.available_count }} –ø–æ—Ä—Ü–∏–π</span>
                        {% if user and user.role == 'student' %}
                        <form method="POST" action="{{ url_for('create_order_frontend') }}" class="order-form">
                            <input type="hidden" name="menu_id" value="{{ menu.id }}">
                            <button type="submit" class="btn btn-sm btn-primary"
                                    {% if menu.available_count <= 0 %}disabled{% endif %}>
                                <i class="fas fa-shopping-cart"></i> –ó–∞–∫–∞–∑–∞—Ç—å
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="no-menu">
        <i class="fas fa-clipboard-list fa-3x"></i>
        <h3>–ú–µ–Ω—é –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ</p>
    </div>
    {% endif %}

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª–µ -->
    <div class="week-navigation">
        <h3>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</h3>
        <div class="week-days">
            {% for date_str in week_dates %}
            <a href="/menu?date={{ date_str }}"
               class="day-link {% if date_str == current_date|string %}active{% endif %}">
                {{ date_str }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π -->
    <div class="menu-info">
        {% if not user %}
        <div class="info-card">
            <h4><i class="fas fa-info-circle"></i> –ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å?</h4>
            <p>–ß—Ç–æ–±—ã –∑–∞–∫–∞–∑–∞—Ç—å –ø–∏—Ç–∞–Ω–∏–µ, –≤–∞–º –Ω—É–∂–Ω–æ:</p>
            <ol>
                <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —É—á–µ–Ω–∏–∫</li>
                <li>–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</li>
                <li>–í—ã–±—Ä–∞—Ç—å –±–ª—é–¥–æ –∏ –Ω–∞–∂–∞—Ç—å "–ó–∞–∫–∞–∑–∞—Ç—å"</li>
                <li>–û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ</li>
            </ol>
        </div>
        {% elif user.role == 'student' %}
        <div class="info-card">
            <h4><i class="fas fa-shopping-cart"></i> –í–∞—à–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h4>
            <p>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≤–∞—à–∏ –∑–∞–∫–∞–∑—ã –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∏—Ö –º–æ–∂–Ω–æ –≤ <a href="{{ url_for('student_dashboard') }}">–ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ</a>.</p>
        </div>
        {% elif user.role == 'cook' %}
        <div class="info-card">
            <h4><i class="fas fa-clipboard-check"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é</h4>
            <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –±–ª—é–¥ –≤ –º–µ–Ω—é –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="{{ url_for('cook_dashboard') }}">–∫–∞–±–∏–Ω–µ—Ç –ø–æ–≤–∞—Ä–∞</a>.</p>
        </div>
        {% elif user.role == 'admin' %}
        <div class="info-card">
            <h4><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
            <p>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ <a href="{{ url_for('admin_dashboard') }}">–ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.menu-container {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    max-width: 1200px;
    margin: 0 auto;
}

.menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
    flex-wrap: wrap;
    gap: 20px;
}

.menu-header h1 {
    margin: 0;
    color: #333;
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-selector {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.date-selector label {
    font-weight: 500;
    color: #333;
}

#menu-date {
    padding: 10px 15px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    min-width: 200px;
}

#menu-date:focus {
    outline: none;
    border-color: #4CAF50;
}

.current-date {
    text-align: center;
    padding: 10px 20px;
    background: #f9f9f9;
    border-radius: 8px;
    border: 1px solid #eee;
}

.current-date h2 {
    margin: 0;
    color: #333;
    font-size: 1.5rem;
}

.current-date p {
    margin: 5px 0 0;
    color: #666;
    font-size: 0.9rem;
}

.menu-sections {
    display: flex;
    flex-direction: column;
    gap: 40px;
}

.menu-section {
    background: #f9f9f9;
    padding: 25px;
    border-radius: 10px;
    border: 1px solid #eee;
}

.menu-section h3 {
    margin-bottom: 25px;
    color: #333;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 2px solid #4CAF50;
}

.menu-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
}

.menu-item-card {
    background: white;
    padding: 25px;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.menu-item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border-color: #4CAF50;
}

.menu-item-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(to bottom, #4CAF50, #2E7D32);
}

.menu-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
    gap: 15px;
}
.menu-item-header h4 {
    margin: 0;
    color: #333;
    font-size: 1.2rem;
    flex: 1;
}

.price {
    font-weight: bold;
    color: #4CAF50;
    font-size: 1.3rem;
    white-space: nowrap;
}

.description {
    color: #666;
    margin-bottom: 20px;
    line-height: 1.6;
    font-size: 0.95rem;
}

.menu-item-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.available {
    color: #666;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.available::before {
    content: 'üì¶';
}

.order-form {
    margin: 0;
}

.btn-sm {
    padding: 8px 16px;
    font-size: 0.9rem;
    border-radius: 5px;
}

.no-menu {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.no-menu i {
    margin-bottom: 20px;
    opacity: 0.3;
    color: #999;
}

.no-menu h3 {
    margin: 15px 0 10px;
    color: #444;
    font-size: 1.3rem;
}

.no-menu p {
    color: #777;
    font-size: 1rem;
}

.week-navigation {
    margin-top: 50px;
    padding-top: 30px;
    border-top: 2px solid #f0f0f0;
}

.week-navigation h3 {
    margin-bottom: 20px;
    color: #333;
    font-size: 1.2rem;
}

.week-days {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.day-link {
    padding: 10px 20px;
    background: #f5f5f5;
    border-radius: 8px;
    text-decoration: none;
    color: #333;
    transition: all 0.3s;
    border: 2px solid transparent;
    font-size: 0.9rem;
    min-width: 120px;
    text-align: center;
}

.day-link:hover {
    background: #e0e0e0;
    transform: translateY(-2px);
}

.day-link.active {
    background: #4CAF50;
    color: white;
    border-color: #388E3C;
    font-weight: 500;
}

.menu-info {
    margin-top: 50px;
    padding-top: 30px;
    border-top: 2px solid #f0f0f0;
}

.info-card {
    background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
    padding: 25px;
    border-radius: 10px;
    border-left: 5px solid #2196F3;
}

.info-card h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #1565C0;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.info-card p {
    color: #333;
    margin-bottom: 15px;
    line-height: 1.6;
}

.info-card ol {
    margin: 15px 0;
    padding-left: 20px;
    color: #333;
}

.info-card li {
    margin-bottom: 8px;
    padding-left: 5px;
}

.info-card a {
    color: #2196F3;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s;
}

.info-card a:hover {
    color: #0D47A1;
    text-decoration: underline;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 992px) {
    .menu-items {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
}

@media (max-width: 768px) {
    .menu-header {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }

    .date-selector {
        flex-direction: column;
        align-items: flex-start;
    }

    #menu-date {
        width: 100%;
    }

    .menu-items {
        grid-template-columns: 1fr;
    }

    .week-days {
        grid-template-columns: repeat(2, 1fr);
    }

    .day-link {
        min-width: 100px;
    }
}

@media (max-width: 480px) {
    .menu-container {
        padding: 15px;
    }

    .menu-section {
        padding: 15px;
    }

    .menu-item-card {
        padding: 20px;
    }

    .menu-item-header {
        flex-direction: column;
        gap: 10px;
    }

    .price {
        align-self: flex-start;
    }

    .week-days {
        grid-template-columns: 1fr;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
.available.high {
    color: #4CAF50;
}

.available.medium {
    color: #FF9800;
}

.available.low {
    color: #f44336;
    font-weight: bold;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É */
@keyframes addToCart {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.btn-primary:active {
    animation: addToCart 0.3s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
.btn-primary:disabled {
    background: #cccccc;
    cursor: not-allowed;
    border-color: #cccccc;
}

.btn-primary:disabled:hover {
    transform: none;
    box-shadow: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('menu-date');
    if (dateInput) {
        dateInput.min = today;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
        if (!dateInput.value) {
            dateInput.value = today;
        }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–∞–∫–∞–∑–∞
    const orderButtons = document.querySelectorAll('.order-form button[type="submit"]');
    orderButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!this.disabled) {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–∫–∞–∑...';
                this.disabled = true;

                // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 2000);
            }
        });
    });

    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–ª—é–¥
    const availableSpans = document.querySelectorAll('.available');
    availableSpans.forEach(span => {
        const text = span.textContent;
        const match = text.match(/\d+/);
        if (match) {
            const count = parseInt(match[0]);
            if (count > 20) {
                span.classList.add('high');
            } else if (count > 5) {
                span.classList.add('medium');
            } else {
                span.classList.add('low');
            }
        }
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã
    if (dateInput) {
        dateInput.addEventListener('change', function() {
            const date = new Date(this.value);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.title = –ú–µ–Ω—é –Ω–∞ ${date.toLocaleDateString('ru-RU', options)} - –®–∫–æ–ª—å–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è;
        });
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
function updateDateTime() {
    const now = new Date();
    const dateElement = document.querySelector('.current-date h2');
    const dayElement = document.querySelector('.current-date p');

    if (dateElement && dayElement) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateElement.textContent = now.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
        dayElement.textContent = now.toLocaleDateString('ru-RU', { weekday: 'long' });
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
setInterval(updateDateTime, 60000);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
updateDateTime();
</script>
{% endblock %}

